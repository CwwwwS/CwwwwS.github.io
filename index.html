<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>H5DS</title>
    <link rel="stylesheet" href="https://cdn.h5ds.com/umd/swiper/style.css" />
    <link href="https://cdn.h5ds.com/lib/plugins/swiper.min.css" rel="stylesheet">
    <!-- 编辑器所需第三方资源库 -->
    <script src="https://cdn.h5ds.com/lib/plugins/swiper.min.js"></script>
    <script src="https://cdn.h5ds.com/lib/plugins/jquery.min.js"></script>
    <script src="https://cdn.h5ds.com/lib/plugins/h5ds.vendor.preview.min.js"></script>
    <!-- es6语法支持 -->
    <script src="https://cdn.h5ds.com/lib/babel/6.26.0/babel.min.js"></script>
    <!-- H5DS资源 -->
    <script src="https://cdn.h5ds.com/umd/swiper/index.js"></script>
    <script>
      window.Component = React.Component;
      var h5dsAppData = {"version":"5.0.0","img":"https://cdn.h5ds.com/upload/fb548399-3d69-4eb6-ab1d-b81b6825333e.JPG","desc":"平平安安！","name":"平安夜快乐!","type":"h5-swiper","slider":{"speed":0.5,"effect":"slide","autoplay":false,"time":5},"style":{"width":320,"height":514},"fixeds":[{"id":null,"className":null,"keyid":"16jwdjpyb9y800","name":"浮动层上","style":{"height":514,"width":320},"layers":[]},{"id":null,"className":null,"keyid":"58qzeo7ad90000","name":"浮动层下","style":{"height":514,"width":320},"layers":[]}],"popups":[],"pages":[{"id":null,"className":null,"keyid":"589o0glj8zs000","name":"空白页面","desc":"页面描述","style":{"width":320,"height":514},"layers":[{"id":null,"className":null,"animate":[{"name":"渐变进入","type":"in","style":"fadeIn 1s ease 1s 1 normal forwards running"}],"data":{"src":"./images/be400a83-1946-429c-8b86-564e8d0966a2.png","naturalWidth":200,"naturalHeight":150,"crop":"{\"top\":0,\"left\":0,\"width\":540,\"height\":540,\"naturalWidth\":540,\"naturalHeight\":540}"},"style":{"width":177,"height":177,"top":245,"left":102},"estyle":{"opacity":0},"events":[],"name":"图片","pid":"h5ds_img","version":"1.0.0","keyid":"23ynqlnaxmf400","set":{"hide":false,"lock":false}},{"id":null,"className":null,"animate":[],"data":{"src":"./images/b0d6a58b-b383-48e4-9853-134797853641.jpg","naturalWidth":200,"naturalHeight":150,"crop":"{\"top\":0,\"left\":0,\"width\":720,\"height\":720,\"naturalWidth\":720,\"naturalHeight\":720}"},"style":{"width":446,"height":399,"top":25,"left":-52.983},"estyle":{},"events":[],"name":"图片","pid":"h5ds_img","version":"1.0.0","keyid":"4vzejwkgnnc000","set":{"hide":false,"lock":false}},{"id":null,"className":null,"animate":[],"data":{"icon":"default","name":"暖暖.m4a","autoplay":true,"loop":false,"delay":0,"duration":47.904,"sound":"https://cdn.h5ds.com/upload/ccf67c77-d658-42b6-bba5-fc0de7ca6e93.m4a"},"style":{"top":0,"left":0,"width":26,"height":26,"display":"block"},"estyle":{},"events":[],"leavePageUnmount":true,"pid":"h5ds_sound","name":"音频","version":"1.0.0","keyid":"2g0bd5leezvo00","set":{"hide":false,"lock":false}},{"id":null,"className":null,"animate":[],"data":{"data":"&nbsp; &nbsp; &nbsp;婧楚！<div>圣诞快乐！！！<div>&nbsp; &nbsp;&nbsp;</div></div>","fontFamilySet":{"name":"默认字体","url":""},"style":{"letterSpacing":"normal","color":"rgba(0,0,0,1)","textDecoration":"normal","textAlign":"left","fontFamily":"默认字体","fontSize":"18px"},"artword":{"type":"","name":"","colors":[]},"animate":{"name":"快闪","interval":"0.125s","type":"in","animate":"fastShow","time":"3s","delay":"0s","count":1,"fun":"linear"},"keyid":"37jlqcjvm2y000"},"style":{"width":138,"height":79.0909,"top":429.446,"left":118},"estyle":{},"events":[],"name":"文本","pid":"h5ds_text","version":"1.0.0","keyid":"1quvp9rvyjcw00","set":{"hide":false,"lock":false}},{"id":null,"className":null,"animate":[],"data":{"src":"./images/b0d6a58b-b383-48e4-9853-134797853641.jpg","naturalWidth":200,"naturalHeight":150,"crop":"{\"top\":0,\"left\":0,\"width\":720,\"height\":720,\"naturalWidth\":720,\"naturalHeight\":720}"},"style":{"width":450,"height":400,"top":24,"left":-57},"estyle":{},"events":[],"name":"图片","pid":"h5ds_img","version":"1.0.0","keyid":"2jpuncyk6gw000","set":{"hide":false,"lock":false}}],"slider":{"animate":1,"autoplay":false,"lock":false,"time":5}},{"id":null,"className":null,"keyid":"4hbv09dkk1k000","name":"未命名","desc":"页面描述","style":{"height":514,"width":320,"backgroundColor":"rgba(255,255,255,1)","backgroundRepeat":"no-repeat","backgroundImageCrop":"{}","backgroundGlobal":false,"backgroundSize":"initial","backgroundImage":""},"layers":[{"id":null,"className":null,"animate":[],"data":{"icon":"default","name":"暖暖.m4a","autoplay":true,"loop":true,"delay":0,"duration":47.904,"sound":"https://cdn.h5ds.com/upload/ccf67c77-d658-42b6-bba5-fc0de7ca6e93.m4a"},"style":{"top":0,"left":0,"width":26,"height":26,"display":"block","flip":[-1,1]},"estyle":{"backgroundColor":"rgba(255,255,255,1)"},"events":[],"leavePageUnmount":true,"pid":"h5ds_sound","name":"音频","version":"1.0.0","keyid":"1tw06slupcdc00","set":{"hide":false,"lock":false}},{"id":null,"className":null,"animate":[],"data":{"data":"&nbsp; &nbsp; &nbsp; 考试加油！<div>&nbsp; &nbsp; &nbsp; 想念你！！</div>","fontFamilySet":{"name":"默认字体","url":""},"style":{"letterSpacing":"normal","color":"rgba(0,0,0,1)","textDecoration":"normal","textAlign":"left","fontFamily":"默认字体","fontSize":"18px"},"artword":{"type":"","name":"","colors":[]},"animate":{"name":"快闪","interval":"0.125s","type":"in","animate":"fastShow","time":"3s","delay":"0s","count":1,"fun":"linear"},"keyid":"37jlqcjvm2y000"},"style":{"width":145,"height":52.7273,"top":430,"left":87.5},"estyle":{},"events":[],"name":"文本","pid":"h5ds_text","version":"1.0.0","keyid":"2p66jqke7um000","set":{"hide":false,"lock":false}},{"id":null,"className":null,"animate":[{"name":"渐变进入","type":"in","style":"fadeIn 2.2s ease 1.7s 1 normal forwards running"}],"data":{"src":"https://cdn.h5ds.com/upload/fb548399-3d69-4eb6-ab1d-b81b6825333e.JPG","naturalWidth":200,"naturalHeight":150,"crop":"{\"top\":0,\"left\":0,\"width\":700,\"height\":700,\"naturalWidth\":700,\"naturalHeight\":700}"},"style":{"width":95,"height":97,"top":333.011,"left":121},"estyle":{"opacity":0},"events":[],"name":"图片","pid":"h5ds_img","version":"1.0.0","keyid":"47uhvg2d77c000","set":{"hide":false,"lock":false}},{"id":null,"className":null,"animate":[],"data":{"src":"https://cdn.h5ds.com/upload/31395d04-be0f-430c-b07b-15d9b841c317.JPG","naturalWidth":200,"naturalHeight":150,"crop":"{\"top\":0,\"left\":0,\"width\":700,\"height\":700,\"naturalWidth\":700,\"naturalHeight\":700}"},"style":{"width":350,"height":381.5,"top":30,"left":-15},"estyle":{},"events":[],"name":"图片","pid":"h5ds_img","version":"1.0.0","keyid":"oefi3o1yx5s0","set":{"hide":false,"lock":false}}],"animate":[],"slider":{"autoplay":false,"lock":false,"time":5}}],"plugins":[]}; var APP_ID = "3f886e96e95f4ac299b57f811ce23019";
    </script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #H5DS-APP {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="H5DS-APP"></div>
  </body>
  <script type="text/babel">
    class App extends Component {
      state = {
        width: window.innerWidth,
        height: window.innerHeight
      };

      resize = () => {
        this.setState(
          {
            width: window.innerWidth,
            height: window.innerHeight
          },
          () => {
            this.H5SwiperRef.swiperInstance.update();
          }
        );
      };

      setSize = (width, height) => {
        this.setState({ width, height }, () => {
          this.H5SwiperRef.swiperInstance.update();
        });
      };

      componentDidMount() {
        const innerHeight = window.innerHeight;

        // 兼容安卓键盘弹起事件
        window.addEventListener("resize", () => {
          const newInnerHeight = window.innerHeight;
          if (innerHeight > newInnerHeight) {
            // 键盘弹出事件处理
            this.resize();
          } else {
            // 键盘收起事件处理
            this.resize();
          }
        });

        // 兼容 IOS 键盘弹起事件，兼容IOS表单的问题
        document.body.addEventListener("focusin", () => {
          window.scroll(0, 0);
        });
        document.body.addEventListener("focusout", () => {
          window.scroll(0, 0);
        });
      }

      componentWillUnmount() {
        if (this.settime) {
          clearTimeout(this.settime);
        }
      }

      render() {
        const { width, height } = this.state;
        let scale = 1;
        switch(this.props.data.type) {
          case 'phone':
          case 'horizontal-phone':
            scale = width / 320;
            break;
          case 'ppt':
            scale = window.innerHeight / 720;
            break;
        }
        return (
          <H5dsSwiper
            ref={c => (this.H5SwiperRef = c)}
            scale={scale}
            style={{ width, height }}
            renderIn="render_in_publish"
            data={this.props.data}
            plugins={{
              pluginsKey: window.H5DS_GLOBAL.plugins,
              scripts: window.H5DS_GLOBAL.scripts
            }}
          />
        );
      }
    }

    function initData(appId, data) {
      document.title = data.name;
      const plus = data.plugins || [];
      const { installPlugins } = window.H5DS_GLOBAL.swiper;
      installPlugins(plus, '.').then(plugins => {
        ReactDOM.render(
          <App appId={appId} data={data} plugins={plugins} />,
          document.getElementById("H5DS-APP")
        );
      });
    }

    initData(APP_ID, h5dsAppData);
  </script>
</html>
