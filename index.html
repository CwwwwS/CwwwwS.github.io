<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>H5DS</title>
    <link rel="stylesheet" href="https://cdn.h5ds.com/umd/swiper/style.css" />
    <link href="https://cdn.h5ds.com/lib/plugins/swiper.min.css" rel="stylesheet">
    <!-- 编辑器所需第三方资源库 -->
    <script src="https://cdn.h5ds.com/lib/plugins/swiper.min.js"></script>
    <script src="https://cdn.h5ds.com/lib/plugins/jquery.min.js"></script>
    <script src="https://cdn.h5ds.com/lib/plugins/h5ds.vendor.preview.min.js"></script>
    <!-- es6语法支持 -->
    <script src="https://cdn.h5ds.com/lib/babel/6.26.0/babel.min.js"></script>
    <!-- H5DS资源 -->
    <script src="https://cdn.h5ds.com/umd/swiper/index.js"></script>
    <script>
      window.Component = React.Component;
      var h5dsAppData = {"img":"https://cdn.h5ds.com/upload/223f7403-09ab-491c-ad51-839097575e44.JPG","desc":"感谢有你！","name":"感恩节快乐~","loading":"1","set":{},"type":"phone","slider":{"speed":0.5,"effect":"slide","autoplay":false,"time":5},"style":{"width":320,"height":514,"backgroundColor":"rgb(255, 255, 255)","backgroundRepeat":"no-repeat","backgroundImageCrop":"{}","backgroundSize":"100% 100%","backgroundImage":"url(https://cdn.h5ds.com/upload/6fb8be46-c096-4857-b365-977b49c32264.JPG)","backgroundGlobal":false},"popups":[],"fixeds":[{"id":null,"name":"浮动层上","style":{"height":514,"width":320},"layers":[],"keyid":"5c4hlsh88yk000"},{"id":null,"name":"浮动层下","style":{"height":514,"width":320},"layers":[],"keyid":"so7gu6dp9jk00"}],"pages":[{"id":null,"className":null,"keyid":"3klewvbghou000","name":"未命名","desc":"页面描述","style":{"height":514,"width":320},"layers":[{"id":null,"className":null,"animate":[],"data":{"icon":"default","name":"暖暖.m4a","autoplay":true,"loop":true,"delay":0,"duration":47.904,"sound":"http://zuikeaidejingchu.xyz/music/%E6%9A%96%E6%9A%96.m4a"},"style":{"top":0,"left":0,"width":26,"height":26,"display":"block"},"estyle":{},"events":[],"leavePageUnmount":true,"pid":"h5ds_sound","name":"音频","version":"1.0.0","keyid":"1q3u1635rrog00","set":{"hide":false,"lock":false},"adsorb":""}],"animate":[],"slider":{"autoplay":false,"lock":false,"time":5}}],"version":"5.0.0","plugins":[]}; var APP_ID = "d770dab72e4345d78360302e3c6a9761";
    </script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #H5DS-APP {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="H5DS-APP"></div>
  </body>
  <script type="text/babel">
    class App extends Component {
      state = {
        width: window.innerWidth,
        height: window.innerHeight
      };

      resize = () => {
        this.setState(
          {
            width: window.innerWidth,
            height: window.innerHeight
          },
          () => {
            this.H5SwiperRef.swiperInstance.update();
          }
        );
      };

      setSize = (width, height) => {
        this.setState({ width, height }, () => {
          this.H5SwiperRef.swiperInstance.update();
        });
      };

      componentDidMount() {
        const innerHeight = window.innerHeight;

        // 兼容安卓键盘弹起事件
        window.addEventListener("resize", () => {
          const newInnerHeight = window.innerHeight;
          if (innerHeight > newInnerHeight) {
            // 键盘弹出事件处理
            this.resize();
          } else {
            // 键盘收起事件处理
            this.resize();
          }
        });

        // 兼容 IOS 键盘弹起事件，兼容IOS表单的问题
        document.body.addEventListener("focusin", () => {
          window.scroll(0, 0);
        });
        document.body.addEventListener("focusout", () => {
          window.scroll(0, 0);
        });
      }

      componentWillUnmount() {
        if (this.settime) {
          clearTimeout(this.settime);
        }
      }

      render() {
        const { width, height } = this.state;
        let scale = 1;
        switch(this.props.data.type) {
          case 'phone':
          case 'horizontal-phone':
            scale = width / 320;
            break;
          case 'ppt':
            scale = window.innerHeight / 720;
            break;
        }
        return (
          <H5dsSwiper
            ref={c => (this.H5SwiperRef = c)}
            scale={scale}
            style={{ width, height }}
            renderIn="render_in_publish"
            data={this.props.data}
            plugins={{
              pluginsKey: window.H5DS_GLOBAL.plugins,
              scripts: window.H5DS_GLOBAL.scripts
            }}
          />
        );
      }
    }

    function initData(appId, data) {
      document.title = data.name;
      const plus = data.plugins || [];
      const { installPlugins } = window.H5DS_GLOBAL.swiper;
      installPlugins(plus, '.').then(plugins => {
        ReactDOM.render(
          <App appId={appId} data={data} plugins={plugins} />,
          document.getElementById("H5DS-APP")
        );
      });
    }

    initData(APP_ID, h5dsAppData);
  </script>
</html>
